<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Concrete Mix Design ‚Äî IS 10262:2019</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f1117;
    --surface: #181c27;
    --card: #1e2330;
    --border: #2a3045;
    --accent: #f5a623;
    --accent2: #4ecdc4;
    --accent3: #e74c3c;
    --text: #e8ecf0;
    --muted: #7a8499;
    --success: #27ae60;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  /* Grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: linear-gradient(rgba(245,166,35,0.04) 1px, transparent 1px),
                      linear-gradient(90deg, rgba(245,166,35,0.04) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .wrapper { position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; padding: 20px 16px 60px; }

  /* HEADER */
  header {
    display: flex; flex-direction: column; align-items: center;
    padding: 40px 0 30px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 32px;
  }
  .badge {
    display: inline-block;
    background: rgba(245,166,35,0.12);
    border: 1px solid rgba(245,166,35,0.3);
    color: var(--accent);
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    letter-spacing: 2px;
    padding: 4px 14px;
    border-radius: 20px;
    margin-bottom: 14px;
  }
  h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(38px, 7vw, 72px);
    letter-spacing: 3px;
    background: linear-gradient(135deg, #f5a623 0%, #f5e04b 60%, #fff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-align: center;
    line-height: 1;
  }
  .subtitle {
    color: var(--muted);
    font-size: 13px;
    letter-spacing: 1.5px;
    margin-top: 8px;
    text-transform: uppercase;
    font-family: 'DM Mono', monospace;
  }

  /* STEPS */
  .steps-nav {
    display: flex; gap: 6px; flex-wrap: wrap;
    justify-content: center; margin-bottom: 32px;
  }
  .step-dot {
    display: flex; align-items: center; gap: 8px;
    padding: 6px 14px;
    border-radius: 30px;
    border: 1px solid var(--border);
    background: var(--surface);
    font-size: 12px;
    font-family: 'DM Mono', monospace;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
  }
  .step-dot.active { border-color: var(--accent); color: var(--accent); background: rgba(245,166,35,0.08); }
  .step-dot.done { border-color: var(--accent2); color: var(--accent2); background: rgba(78,205,196,0.08); }
  .step-dot .num {
    width: 20px; height: 20px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 11px; background: var(--border);
  }
  .step-dot.active .num { background: var(--accent); color: #000; }
  .step-dot.done .num { background: var(--accent2); color: #000; }

  /* SECTIONS */
  .section { display: none; animation: fadeIn 0.3s ease; }
  .section.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: none; } }

  .section-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 28px;
    letter-spacing: 2px;
    color: var(--accent);
    margin-bottom: 6px;
    display: flex; align-items: center; gap: 10px;
  }
  .section-desc { color: var(--muted); font-size: 13px; margin-bottom: 24px; }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
  @media(max-width: 680px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }

  .field {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 16px;
    transition: border-color 0.2s;
  }
  .field:focus-within { border-color: var(--accent); }

  .field label {
    display: block;
    font-size: 11px;
    font-family: 'DM Mono', monospace;
    letter-spacing: 1px;
    color: var(--muted);
    margin-bottom: 8px;
    text-transform: uppercase;
  }
  .field label span { color: var(--accent); font-size: 14px; vertical-align: middle; margin-left: 4px; }
  .field input, .field select {
    width: 100%;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 16px;
    font-weight: 500;
  }
  .field select option { background: var(--card); }
  .field .unit {
    font-size: 11px; color: var(--accent2); font-family: 'DM Mono', monospace;
    margin-top: 4px;
  }

  /* INFO BOX */
  .info-box {
    background: rgba(78,205,196,0.05);
    border: 1px solid rgba(78,205,196,0.2);
    border-radius: 10px;
    padding: 14px 18px;
    margin-bottom: 20px;
    font-size: 13px;
    color: var(--accent2);
    font-family: 'DM Mono', monospace;
  }

  /* BUTTONS */
  .btn-row { display: flex; gap: 12px; margin-top: 28px; flex-wrap: wrap; }
  .btn {
    padding: 12px 28px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 14px;
    letter-spacing: 0.5px;
    transition: all 0.2s;
  }
  .btn-primary { background: var(--accent); color: #000; }
  .btn-primary:hover { background: #f5c650; transform: translateY(-1px); }
  .btn-secondary {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
  }
  .btn-secondary:hover { border-color: var(--accent); color: var(--accent); }
  .btn-calc {
    background: linear-gradient(135deg, #f5a623, #e8893a);
    color: #000;
    font-size: 16px;
    padding: 14px 40px;
    border-radius: 10px;
    font-weight: 700;
    letter-spacing: 1px;
    box-shadow: 0 4px 20px rgba(245,166,35,0.3);
  }
  .btn-calc:hover { box-shadow: 0 6px 30px rgba(245,166,35,0.5); transform: translateY(-2px); }

  /* RESULTS */
  #results-section { display: none; }
  #results-section.show { display: block; }

  .result-header {
    background: linear-gradient(135deg, rgba(245,166,35,0.1), rgba(78,205,196,0.05));
    border: 1px solid rgba(245,166,35,0.2);
    border-radius: 14px;
    padding: 28px 32px;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
  }
  .result-header::after {
    content: 'M' attr(data-grade);
    font-family: 'Bebas Neue', sans-serif;
    font-size: 120px;
    position: absolute;
    right: -10px; top: -20px;
    opacity: 0.05;
    color: var(--accent);
    pointer-events: none;
  }
  .result-grade {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 56px;
    letter-spacing: 3px;
    background: linear-gradient(135deg, var(--accent), #f5e04b);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .result-sub { color: var(--muted); font-size: 13px; margin-top: 4px; }

  .result-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 14px;
    margin-bottom: 28px;
  }
  .result-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 18px;
    transition: border-color 0.2s, transform 0.2s;
  }
  .result-card:hover { border-color: var(--accent); transform: translateY(-2px); }
  .result-card .mat {
    font-size: 11px;
    font-family: 'DM Mono', monospace;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }
  .result-card .val {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 36px;
    letter-spacing: 1px;
  }
  .result-card .unit-sm { font-size: 13px; color: var(--muted); font-family: 'DM Mono', monospace; }

  .wc-card { border-color: rgba(78,205,196,0.3); }
  .wc-card .val { color: var(--accent2); }
  .cement-card { border-color: rgba(245,166,35,0.3); }
  .cement-card .val { color: var(--accent); }
  .fa-card .val { color: #9b59b6; }
  .water-card .val { color: #3498db; }
  .ca-card .val { color: #e74c3c; }
  .fine-card .val { color: #2ecc71; }

  .ratio-display {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px 24px;
    margin-bottom: 24px;
    display: flex; align-items: center; gap: 20px; flex-wrap: wrap;
  }
  .ratio-label { color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; font-family: 'DM Mono', monospace; }
  .ratio-val {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 32px;
    color: var(--accent);
    letter-spacing: 2px;
  }

  .steps-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
    margin-bottom: 28px;
  }
  .steps-table th {
    background: rgba(245,166,35,0.08);
    color: var(--accent);
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    letter-spacing: 1px;
    text-transform: uppercase;
    padding: 10px 14px;
    text-align: left;
    border-bottom: 1px solid var(--border);
  }
  .steps-table td {
    padding: 10px 14px;
    border-bottom: 1px solid rgba(42,48,69,0.5);
    color: var(--muted);
    vertical-align: top;
  }
  .steps-table td:first-child { color: var(--accent2); font-family: 'DM Mono', monospace; font-weight: 500; }
  .steps-table td:nth-child(3) { color: var(--text); font-family: 'DM Mono', monospace; }
  .steps-table tr:hover td { background: rgba(255,255,255,0.02); }

  .print-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 10px 22px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.2s;
    display: inline-flex; align-items: center; gap: 6px;
  }
  .print-btn:hover { border-color: var(--accent2); color: var(--accent2); }

  .error-msg {
    color: var(--accent3);
    background: rgba(231,76,60,0.1);
    border: 1px solid rgba(231,76,60,0.3);
    border-radius: 8px;
    padding: 12px 16px;
    font-size: 13px;
    margin-top: 12px;
    display: none;
    font-family: 'DM Mono', monospace;
  }
  .error-msg.show { display: block; }

  .progress-bar {
    height: 3px;
    background: var(--border);
    border-radius: 3px;
    margin-bottom: 28px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius: 3px;
    transition: width 0.4s ease;
  }

  @media print {
    body { background: white; color: #000; }
    body::before { display: none; }
    .steps-nav, .btn-row, .print-btn { display: none; }
    .result-card { border: 1px solid #ddd; }
    h1 { -webkit-text-fill-color: #000; }
  }
</style>
</head>
<body>
<div class="wrapper">

  <header>
    <div class="badge">IS 10262 : 2019</div>
    <h1>CONCRETE MIX DESIGN</h1>
    <div class="subtitle">Bureau of Indian Standards ¬∑ Step-by-Step Calculator</div>
  </header>

  <!-- Step Navigation -->
  <div class="steps-nav" id="stepsNav">
    <div class="step-dot active" onclick="gotoStep(1)" id="dot1"><span class="num">1</span> Target Strength</div>
    <div class="step-dot" onclick="gotoStep(2)" id="dot2"><span class="num">2</span> W/C Ratio</div>
    <div class="step-dot" onclick="gotoStep(3)" id="dot3"><span class="num">3</span> Water Content</div>
    <div class="step-dot" onclick="gotoStep(4)" id="dot4"><span class="num">4</span> Aggregates</div>
    <div class="step-dot" onclick="gotoStep(5)" id="dot5"><span class="num">5</span> Calculate</div>
  </div>

  <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:20%"></div></div>

  <!-- ========== STEP 1: Target Strength ========== -->
  <div class="section active" id="step1">
    <div class="section-title">üìã Step 1 ‚Äî Target Mean Strength</div>
    <div class="section-desc">Based on IS 456:2000 ‚Äî Exposure condition, grade & standard deviation</div>

    <div class="info-box">
      f'ck = fck + 1.65 √ó S &nbsp;&nbsp;|&nbsp;&nbsp; IS 10262:2019 Cl. 3.2
    </div>

    <div class="grid-2">
      <div class="field">
        <label>Grade of Concrete <span>*</span></label>
        <select id="grade">
          <option value="20">M20</option>
          <option value="25" selected>M25</option>
          <option value="30">M30</option>
          <option value="35">M35</option>
          <option value="40">M40</option>
          <option value="45">M45</option>
          <option value="50">M50</option>
          <option value="55">M55</option>
          <option value="60">M60</option>
        </select>
      </div>
      <div class="field">
        <label>Type of Cement <span>*</span></label>
        <select id="cementType">
          <option value="OPC43">OPC 43 Grade</option>
          <option value="OPC53" selected>OPC 53 Grade</option>
          <option value="PPC">PPC (Portland Pozzolana Cement)</option>
          <option value="PSC">PSC (Portland Slag Cement)</option>
        </select>
      </div>
      <div class="field">
        <label>Exposure Condition <span>*</span></label>
        <select id="exposure">
          <option value="mild">Mild</option>
          <option value="moderate" selected>Moderate</option>
          <option value="severe">Severe</option>
          <option value="v_severe">Very Severe</option>
          <option value="extreme">Extreme</option>
        </select>
      </div>
      <div class="field">
        <label>Standard Deviation (S) ‚Äî MPa
          <span title="As per IS 10262 Table 1">‚Ñπ</span>
        </label>
        <input type="number" id="sd" value="4.0" step="0.1" min="2" max="6">
        <div class="unit">MPa ‚Äî IS 10262:2019 Table 1</div>
      </div>
      <div class="field">
        <label>Method of Concrete Placing</label>
        <select id="placing">
          <option value="pump">Pump</option>
          <option value="manual" selected>Manual / Normal</option>
          <option value="shotcrete">Shotcrete</option>
        </select>
      </div>
      <div class="field">
        <label>Workability (Slump) ‚Äî mm <span>*</span></label>
        <select id="slump">
          <option value="25-50">25‚Äì50 mm (Low)</option>
          <option value="50-75">50‚Äì75 mm (Low-Medium)</option>
          <option value="75-100" selected>75‚Äì100 mm (Medium)</option>
          <option value="100-125">100‚Äì125 mm (High)</option>
          <option value="125-150">125‚Äì150 mm (Very High)</option>
        </select>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" onclick="gotoStep(2)">Next ‚Üí</button>
    </div>
  </div>

  <!-- ========== STEP 2: W/C Ratio ========== -->
  <div class="section" id="step2">
    <div class="section-title">üíß Step 2 ‚Äî Water/Cement Ratio</div>
    <div class="section-desc">From IS 456:2000 Table 5 ‚Äî Max w/c for durability, and design chart correlation</div>

    <div class="info-box">
      w/c selected shall satisfy both strength & durability requirements ‚Äî IS 10262:2019 Cl. 4.3
    </div>

    <div class="grid-2">
      <div class="field">
        <label>Specific Gravity of Cement</label>
        <input type="number" id="sgCement" value="3.15" step="0.01" min="2.9" max="3.3">
      </div>
      <div class="field">
        <label>Fly Ash / Admixture Used?</label>
        <select id="flyAshUsed">
          <option value="no" selected>No</option>
          <option value="yes">Yes ‚Äî Fly Ash (FA)</option>
          <option value="ggbs">Yes ‚Äî GGBS</option>
          <option value="sf">Yes ‚Äî Silica Fume</option>
        </select>
      </div>
      <div class="field" id="flyAshPctField" style="display:none">
        <label>Fly Ash / SCM Replacement (%)</label>
        <input type="number" id="flyAshPct" value="20" min="0" max="35">
        <div class="unit">% by weight of cementitious material</div>
      </div>
      <div class="field">
        <label>Chemical Admixture (Superplasticizer)?</label>
        <select id="admixture">
          <option value="no" selected>No</option>
          <option value="yes">Yes</option>
        </select>
      </div>
      <div class="field">
        <label>Specific Gravity of Fly Ash / SCM</label>
        <input type="number" id="sgFA" value="2.20" step="0.01" min="1.8" max="2.9">
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-secondary" onclick="gotoStep(1)">‚Üê Back</button>
      <button class="btn btn-primary" onclick="gotoStep(3)">Next ‚Üí</button>
    </div>
  </div>

  <!-- ========== STEP 3: Water Content ========== -->
  <div class="section" id="step3">
    <div class="section-title">üåä Step 3 ‚Äî Water Content</div>
    <div class="section-desc">From IS 10262:2019 Table 2 ‚Äî based on aggregate size & workability</div>

    <div class="info-box">
      Approximate water content for nominal max. aggregate size ‚Äî IS 10262:2019 Table 2
    </div>

    <div class="grid-2">
      <div class="field">
        <label>Nominal Max Aggregate Size <span>*</span></label>
        <select id="aggSize">
          <option value="10">10 mm</option>
          <option value="12.5">12.5 mm</option>
          <option value="20" selected>20 mm</option>
          <option value="40">40 mm</option>
        </select>
      </div>
      <div class="field">
        <label>Type of Coarse Aggregate</label>
        <select id="aggType">
          <option value="crushed" selected>Crushed (Angular)</option>
          <option value="gravel">Gravel (Rounded)</option>
          <option value="semirounded">Semi-Angular</option>
        </select>
      </div>
      <div class="field">
        <label>Water Content Override ‚Äî kg/m¬≥</label>
        <input type="number" id="waterOverride" placeholder="Leave blank to use IS table values" min="100" max="250">
        <div class="unit">Optional ‚Äî overrides table value</div>
      </div>
      <div class="field">
        <label>Superplasticizer Reduction (%)</label>
        <input type="number" id="spReduction" value="0" min="0" max="30">
        <div class="unit">% water reduction due to SP (if used)</div>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-secondary" onclick="gotoStep(2)">‚Üê Back</button>
      <button class="btn btn-primary" onclick="gotoStep(4)">Next ‚Üí</button>
    </div>
  </div>

  <!-- ========== STEP 4: Aggregates ========== -->
  <div class="section" id="step4">
    <div class="section-title">ü™® Step 4 ‚Äî Aggregate Properties</div>
    <div class="section-desc">Specific gravities, absorption & fine aggregate zone for volume calculations</div>

    <div class="grid-3">
      <div class="field">
        <label>Specific Gravity ‚Äî Coarse Aggregate</label>
        <input type="number" id="sgCA" value="2.74" step="0.01" min="2.4" max="3.0">
      </div>
      <div class="field">
        <label>Specific Gravity ‚Äî Fine Aggregate</label>
        <input type="number" id="sgFA2" value="2.65" step="0.01" min="2.4" max="3.0">
      </div>
      <div class="field">
        <label>Zone of Fine Aggregate (IS 383)</label>
        <select id="faZone">
          <option value="1">Zone I (Coarse)</option>
          <option value="2" selected>Zone II</option>
          <option value="3">Zone III</option>
          <option value="4">Zone IV (Fine)</option>
        </select>
      </div>
      <div class="field">
        <label>Water Absorption ‚Äî CA (%)</label>
        <input type="number" id="absCA" value="0.5" step="0.1" min="0" max="3">
      </div>
      <div class="field">
        <label>Water Absorption ‚Äî FA (%)</label>
        <input type="number" id="absFA" value="1.0" step="0.1" min="0" max="3">
      </div>
      <div class="field">
        <label>Moisture in CA (%)</label>
        <input type="number" id="moistCA" value="0" step="0.1" min="0" max="5">
      </div>
      <div class="field">
        <label>Moisture in FA (%)</label>
        <input type="number" id="moistFA" value="2" step="0.1" min="0" max="8">
      </div>
      <div class="field">
        <label>Entrapped Air (%)</label>
        <input type="number" id="airContent" value="1.0" step="0.5" min="0" max="5">
        <div class="unit">IS 10262 Table 3</div>
      </div>
      <div class="field">
        <label>Volume of Entrapped / Entrained Air</label>
        <select id="airType">
          <option value="entrapped" selected>Entrapped (Non-air entrained)</option>
          <option value="entrained">Entrained (Air entrained)</option>
        </select>
      </div>
    </div>

    <div class="btn-row">
      <button class="btn btn-secondary" onclick="gotoStep(3)">‚Üê Back</button>
      <button class="btn btn-calc" onclick="calculate()">‚ö° Calculate Mix Design</button>
    </div>
    <div class="error-msg" id="errorMsg"></div>
  </div>

  <!-- ========== RESULTS ========== -->
  <div id="results-section">
    <hr style="border-color: var(--border); margin: 40px 0 30px;">

    <div class="result-header" id="resultHeader" data-grade="25">
      <div class="result-grade" id="resultGrade">M25 Mix Design</div>
      <div class="result-sub" id="resultSub">IS 10262 : 2019 | Non-air entrained concrete</div>
      <button class="print-btn" style="margin-top:12px" onclick="window.print()">üñ® Print Report</button>
    </div>

    <!-- Key Quantities -->
    <div style="color: var(--muted); font-family:'DM Mono',monospace; font-size:11px; letter-spacing:1.5px; text-transform:uppercase; margin-bottom:14px;">
      Per 1 m¬≥ of Concrete
    </div>

    <div class="result-grid">
      <div class="result-card water-card">
        <div class="mat">Water</div>
        <div class="val" id="r_water">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
      <div class="result-card cement-card">
        <div class="mat">Cement</div>
        <div class="val" id="r_cement">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
      <div class="result-card fa-card" id="faCard" style="display:none">
        <div class="mat" id="faCardTitle">Fly Ash</div>
        <div class="val" id="r_fa">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
      <div class="result-card fine-card">
        <div class="mat">Fine Aggregate</div>
        <div class="val" id="r_sand">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
      <div class="result-card ca-card">
        <div class="mat">Coarse Aggregate</div>
        <div class="val" id="r_ca">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
      <div class="result-card wc-card">
        <div class="mat">w/c Ratio</div>
        <div class="val" id="r_wc">‚Äî</div>
        <div class="unit-sm">‚Äì</div>
      </div>
    </div>

    <!-- Ratio -->
    <div class="ratio-display">
      <div>
        <div class="ratio-label">Mix Ratio (by weight)</div>
        <div class="ratio-val" id="r_ratio">‚Äî : ‚Äî : ‚Äî</div>
      </div>
      <div style="border-left:1px solid var(--border); height:50px; display:block;"></div>
      <div>
        <div class="ratio-label">Target Mean Strength</div>
        <div class="ratio-val" id="r_tms">‚Äî MPa</div>
      </div>
      <div style="border-left:1px solid var(--border); height:50px; display:block;"></div>
      <div>
        <div class="ratio-label">w/cm Ratio</div>
        <div class="ratio-val" id="r_wcm">‚Äî</div>
      </div>
    </div>

    <!-- Adjusted for Site (SSD Basis) -->
    <div style="color: var(--accent); font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:2px; margin-bottom:14px;">
      Adjusted Quantities (Site / SSD Basis)
    </div>
    <div class="result-grid" id="siteGrid">
      <div class="result-card">
        <div class="mat">Water (Actual)</div>
        <div class="val" id="r_waterAdj">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
      <div class="result-card cement-card">
        <div class="mat">Cement (Same)</div>
        <div class="val" id="r_cementAdj">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
      <div class="result-card fine-card">
        <div class="mat">FA (Site)</div>
        <div class="val" id="r_sandAdj">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
      <div class="result-card ca-card">
        <div class="mat">CA (Site)</div>
        <div class="val" id="r_caAdj">‚Äî</div>
        <div class="unit-sm">kg/m¬≥</div>
      </div>
    </div>

    <!-- Step-by-step table -->
    <div style="color: var(--accent); font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:2px; margin-bottom:14px;">
      Step-by-Step Calculation Trail
    </div>
    <table class="steps-table" id="calcTable">
      <thead>
        <tr>
          <th>Step</th>
          <th>Description</th>
          <th>Value</th>
          <th>Ref</th>
        </tr>
      </thead>
      <tbody id="calcBody"></tbody>
    </table>

    <div class="btn-row">
      <button class="btn btn-secondary" onclick="resetForm()">üîÑ New Design</button>
      <button class="print-btn" onclick="window.print()">üñ® Print Report</button>
    </div>
  </div>

</div><!-- end wrapper -->

<script>
// ---- IS Tables / Lookups ----
const WC_MAX_DURABILITY = { mild:0.55, moderate:0.50, severe:0.45, v_severe:0.45, extreme:0.40 };
const MIN_CEMENT = { mild:300, moderate:300, severe:320, v_severe:340, extreme:360 };

// IS 10262:2019 Table 2 ‚Äî Water content (kg/m¬≥) for crushed aggregate
// keys: aggSize -> slumpRange -> water
const WATER_TABLE = {
  10:  { "25-50":208, "50-75":210, "75-100":215, "100-125":220, "125-150":225 },
  12.5:{ "25-50":195, "50-75":200, "75-100":205, "100-125":210, "125-150":215 },
  20:  { "25-50":186, "50-75":188, "75-100":191, "100-125":195, "125-150":200 },
  40:  { "25-50":165, "50-75":168, "75-100":170, "100-125":174, "125-150":178 }
};

// Volume of coarse aggregate (fraction) per m¬≥ for FA Zone II, 20mm aggregate
// IS 10262:2019 Table 3
const CA_VOLUME_TABLE = {
  10:  { 1:0.50, 2:0.48, 3:0.46, 4:0.44 },
  12.5:{ 1:0.55, 2:0.53, 3:0.51, 4:0.49 },
  20:  { 1:0.66, 2:0.64, 3:0.62, 4:0.60 },
  40:  { 1:0.73, 2:0.71, 3:0.69, 4:0.67 }
};

// Gravel: subtract 0.02 from CA volume fraction
// Air content by aggregate size (IS 10262)
const AIR_CONTENT_TABLE = { 10:3.0, 12.5:2.5, 20:2.0, 40:1.0 };

// SD defaults by grade (IS 10262:2019 Table 1)
const SD_TABLE = {20:4.0,25:4.0,30:5.0,35:5.0,40:5.0,45:5.0,50:5.0,55:5.0,60:5.0};

let currentStep = 1;

document.getElementById('flyAshUsed').addEventListener('change', function(){
  const show = this.value !== 'no';
  document.getElementById('flyAshPctField').style.display = show ? '' : 'none';
});

// Grade change -> update default SD
document.getElementById('grade').addEventListener('change', function(){
  const g = parseInt(this.value);
  if(SD_TABLE[g]) document.getElementById('sd').value = SD_TABLE[g];
});

function gotoStep(n) {
  for(let i=1;i<=5;i++){
    const sec = document.getElementById('step'+i);
    const dot = document.getElementById('dot'+i);
    if(sec) { sec.classList.toggle('active', i===n); }
    if(dot) {
      dot.classList.toggle('active', i===n);
      dot.classList.toggle('done', i<n);
    }
  }
  currentStep = n;
  document.getElementById('progressFill').style.width = (n/5*100)+'%';
  window.scrollTo({top:0, behavior:'smooth'});
}

function getVal(id) { return parseFloat(document.getElementById(id).value) || 0; }
function getStr(id) { return document.getElementById(id).value; }

function calculate() {
  const err = document.getElementById('errorMsg');
  err.classList.remove('show');

  const grade = parseInt(getStr('grade'));
  const sd = getVal('sd');
  const slump = getStr('slump');
  const aggSize = parseFloat(getStr('aggSize'));
  const aggType = getStr('aggType');
  const faZone = parseInt(getStr('faZone'));
  const sgCement = getVal('sgCement');
  const sgCA = getVal('sgCA');
  const sgFA2 = getVal('sgFA2');
  const sgFAmineral = getVal('sgFA');
  const flyAshUsed = getStr('flyAshUsed');
  const flyAshPct = getVal('flyAshPct') / 100;
  const airContent = getVal('airContent');
  const absCA = getVal('absCA') / 100;
  const absFA = getVal('absFA') / 100;
  const moistCA = getVal('moistCA') / 100;
  const moistFA = getVal('moistFA') / 100;
  const spReduction = getVal('spReduction') / 100;
  const waterOverride = document.getElementById('waterOverride').value;
  const exposure = getStr('exposure');

  // Step 1: Target Mean Strength
  const fck = grade;
  const fckTarget = fck + 1.65 * sd;

  // Step 2: W/C Ratio ‚Äî from strength (Abrams' law fit for IS practice)
  // Relationship from IS 10262 Appendix A (for OPC 43/53)
  // Using simplified: w/c = 0.8 * exp(-0.025 * fck_target) ‚Äî empirical for IS
  let wc = +(0.85 * Math.exp(-0.021 * fckTarget)).toFixed(3);
  // Clamp from durability
  const wcMax = WC_MAX_DURABILITY[exposure];
  const wcUsed = Math.min(wc, wcMax);
  wc = +wcUsed.toFixed(3);

  // Step 3: Water content
  let water;
  if(waterOverride && parseFloat(waterOverride) > 0) {
    water = parseFloat(waterOverride);
  } else {
    const wt = WATER_TABLE[aggSize];
    water = wt ? (wt[slump] || 191) : 191;
    // Gravel correction
    if(aggType === 'gravel') water -= 10;
    if(aggType === 'semirounded') water -= 5;
  }
  // SP reduction
  water = Math.round(water * (1 - spReduction));

  // Step 4: Cement content
  let cementTotal = Math.round(water / wc);
  const minCem = MIN_CEMENT[exposure];
  const actualCement0 = cementTotal;
  if(cementTotal < minCem) {
    cementTotal = minCem;
    // Recalculate wc
    wc = +(water / cementTotal).toFixed(3);
  }

  // Fly ash / SCM
  let cementWt, faMineralWt = 0, totalCem = cementTotal;
  if(flyAshUsed !== 'no' && flyAshPct > 0) {
    cementWt = Math.round(cementTotal * (1 - flyAshPct));
    faMineralWt = Math.round(cementTotal * flyAshPct);
  } else {
    cementWt = cementTotal;
  }

  // Step 5: Volume of coarse aggregate
  let caVolFrac = (CA_VOLUME_TABLE[aggSize] || CA_VOLUME_TABLE[20])[faZone] || 0.64;
  if(aggType === 'gravel') caVolFrac -= 0.02;
  if(aggType === 'semirounded') caVolFrac -= 0.01;
  // Pump: reduce by 0.10 if pump placed
  if(getStr('placing') === 'pump') caVolFrac -= 0.10;
  caVolFrac = Math.max(caVolFrac, 0.30);

  // Step 6: Volume method
  // Vol = mass / (SG * 1000)
  const airVol = airContent / 100;
  const waterVol = water / 1000;
  const cemVol = cementWt / (sgCement * 1000);
  let faMinVol = 0;
  let sgSCM = sgFAmineral;
  if(flyAshUsed !== 'no' && faMineralWt > 0) {
    faMinVol = faMineralWt / (sgSCM * 1000);
  }

  const totalCemVol = cemVol + faMinVol;
  const remainingVol = 1.0 - waterVol - totalCemVol - airVol;

  // CA volume fraction: fraction of (CA+FA) = caVolFrac
  // remainingVol = CA_vol + FA_vol
  const caVol = remainingVol * caVolFrac;
  const faVol = remainingVol * (1 - caVolFrac);

  const caWt = Math.round(caVol * sgCA * 1000);
  const faWt = Math.round(faVol * sgFA2 * 1000);

  // Validation
  if(caWt <= 0 || faWt <= 0) {
    err.textContent = '‚ö† Calculation error: Aggregate volumes invalid. Check input values.';
    err.classList.add('show');
    return;
  }

  // w/cm for SCM case
  const wcm = +(water / totalCem).toFixed(3);

  // Site adjustments (SSD)
  const waterAdj = Math.round(water + (caWt * (absCA - moistCA)) + (faWt * (absFA - moistFA)));
  const caWtAdj = Math.round(caWt * (1 + moistCA));
  const faWtAdj = Math.round(faWt * (1 + moistFA));

  // Mix Ratio
  const ratioCA = +(caWt/cementWt).toFixed(2);
  const ratioFA = +(faWt/cementWt).toFixed(2);

  // --- Populate Results ---
  document.getElementById('resultGrade').textContent = `M${grade} Mix Design`;
  document.getElementById('resultHeader').setAttribute('data-grade', grade);
  document.getElementById('resultSub').textContent =
    `IS 10262:2019 | ${getStr('cementType')} | ${aggSize}mm Aggregate | ${exposure.replace('_',' ')} exposure`;

  document.getElementById('r_water').textContent = water;
  document.getElementById('r_cement').textContent = cementWt;
  document.getElementById('r_sand').textContent = faWt;
  document.getElementById('r_ca').textContent = caWt;
  document.getElementById('r_wc').textContent = wc;

  if(flyAshUsed !== 'no' && faMineralWt > 0) {
    document.getElementById('faCard').style.display = '';
    const titles = {yes:'Fly Ash', ggbs:'GGBS', sf:'Silica Fume'};
    document.getElementById('faCardTitle').textContent = titles[flyAshUsed] || 'SCM';
    document.getElementById('r_fa').textContent = faMineralWt;
  } else {
    document.getElementById('faCard').style.display = 'none';
  }

  const ratioStr = flyAshUsed !== 'no' && faMineralWt > 0
    ? `1 : ${+(faMineralWt/cementWt).toFixed(2)} (SCM) : ${ratioFA} : ${ratioCA}`
    : `1 : ${ratioFA} : ${ratioCA}`;
  document.getElementById('r_ratio').textContent = ratioStr;
  document.getElementById('r_tms').textContent = fckTarget.toFixed(1) + ' MPa';
  document.getElementById('r_wcm').textContent = wcm;

  document.getElementById('r_waterAdj').textContent = waterAdj;
  document.getElementById('r_cementAdj').textContent = cementWt;
  document.getElementById('r_sandAdj').textContent = faWtAdj;
  document.getElementById('r_caAdj').textContent = caWtAdj;

  // Step-by-step table
  const rows = [
    ['S1','Characteristic compressive strength', `f'ck = ${fck} MPa`, 'IS 456:2000'],
    ['S2','Standard deviation', `S = ${sd} MPa`, 'IS 10262:2019 Table 1'],
    ['S3','Target mean strength', `f'ck = ${fckTarget.toFixed(2)} MPa`, 'IS 10262 Cl. 3.2'],
    ['S4','W/C from strength (computed)', `${(water/cementTotal).toFixed(3)}`, 'IS 10262 App. A'],
    ['S5','Max w/c from durability (IS 456)', `${wcMax}`, 'IS 456 Table 5'],
    ['S6','Adopted w/c', `${wc}`, 'min of S4, S5'],
    ['S7','Water content from IS Table 2', `${water} kg/m¬≥`, 'IS 10262:2019 Table 2'],
    ['S8','Cement content (Water/w/c)', `${cementTotal} kg/m¬≥`, 'IS 10262 Cl. 4.4'],
    ['S9','Min cement for exposure', `${minCem} kg/m¬≥`, 'IS 456 Table 5'],
    ['S10','Adopted cement content', `${cementWt} kg/m¬≥`, ''],
    flyAshUsed!=='no' && faMineralWt>0 ? ['S11','Fly Ash / SCM ('+Math.round(flyAshPct*100)+'%)', `${faMineralWt} kg/m¬≥`, 'IS 10262 Cl.4.4'] : null,
    ['S12','Volume of entrapped/entrained air', `${airContent}%`, 'IS 10262 Table 3'],
    ['S13','Vol fraction of CA (IS Table 3)', `${caVolFrac.toFixed(2)}`, 'IS 10262:2019 Table 3'],
    ['S14','Volume of CA', `${caVol.toFixed(4)} m¬≥ ‚Üí ${caWt} kg`, ''],
    ['S15','Volume of FA', `${faVol.toFixed(4)} m¬≥ ‚Üí ${faWt} kg`, ''],
    ['S16','Check: Total volumes', `${(waterVol+totalCemVol+caVol+faVol+airVol).toFixed(4)} m¬≥ ‚âà 1.0`, 'Volume check'],
    ['S17','Mix ratio (C:FA:CA)', `1 : ${ratioFA} : ${ratioCA}`, ''],
    ['S18','Site water (SSD adjusted)', `${waterAdj} kg/m¬≥`, 'IS 10262 Cl. 8'],
    ['S19','Site FA (with surface moisture)', `${faWtAdj} kg/m¬≥`, ''],
    ['S20','Site CA (with surface moisture)', `${caWtAdj} kg/m¬≥`, ''],
  ].filter(Boolean);

  const tbody = document.getElementById('calcBody');
  tbody.innerHTML = rows.map(r =>
    `<tr><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td><td style="color:var(--muted);font-size:11px">${r[3]}</td></tr>`
  ).join('');

  const rs = document.getElementById('results-section');
  rs.classList.add('show');
  setTimeout(()=> rs.scrollIntoView({behavior:'smooth', block:'start'}), 100);
}

function resetForm() {
  document.getElementById('results-section').classList.remove('show');
  gotoStep(1);
  window.scrollTo({top:0,behavior:'smooth'});
}
</script>
</body>
</html>
